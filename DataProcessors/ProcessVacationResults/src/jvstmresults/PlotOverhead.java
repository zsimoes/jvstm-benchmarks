package jvstmresults;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.Writer;

public class PlotOverhead
{

	protected static String nl = System.getProperty("line.separator");

	/* @formatter:off */
	protected static final String gnuplotCode =
			"#Generated by PlotOverhead.java" + nl + nl +
			"set terminal pdf enhanced" + nl +
			"set output '%s'" + nl +
			"set style data histogram" + nl +
			"set style histogram cluster gap 1" + nl +
			"set style fill pattern border" + nl +
			"set auto x" + nl +
			"set key outside right top vertical Left" + nl +
			"set yrange [0:*]" + nl +
			"plot '%s' using 2:xtic(1) lt -1 title col, \\" + nl +
			"        '' using 3:xtic(1) lt -1 title col, \\" + nl +
			"        '' using 4:xtic(1) lt -1 title col, \\" + nl +
			"        '' using 5:xtic(1) lt -1 title col";
	/* @formatter:on */

	public void process(File overheadDataFile)
	{
		String path = overheadDataFile.getParent();
		File gnuplot = new File(path, "overhead.gp");
		File pdf = new File(path, "overhead.pdf");
		try {
		Writer w = new FileWriter(gnuplot, false);
		String script = String.format(gnuplotCode, pdf.getAbsolutePath(), overheadDataFile.getAbsolutePath());
		w.write(script);
		w.close();
		} catch (IOException e) {
			System.err.println("ERROR: " + e.getMessage());
			throw new RuntimeException(e);
		}

		System.err.println("PlotOverhead - generated file " + gnuplot.getParentFile().getName() + "\\" + gnuplot.getName());
	}

}
